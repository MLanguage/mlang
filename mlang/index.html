<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>index (mlang.index)</title><link rel="stylesheet" href="../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ mlang</nav><h1 id="mlang"><a href="#mlang" class="anchor"></a>Mlang</h1><p>The Mlang compiler has a traditionnal architecture consisting of various intermediate representations going from the source code to the target backend.</p><nav class="toc"><ul><li><a href="#m-frontend">M Frontend</a></li><li><a href="#m-intermediate-representation">M Intermediate representation</a></li><li><a href="#m++-frontend">M++ Frontend</a></li><li><a href="#m++-intermediate-representation">M++ Intermediate representation</a></li><li><a href="#m/m++-common-backend-intermediate-representation">M/M++ Common backend intermediate representation</a></li><li><a href="#optimizations">Optimizations</a></li><li><a href="#testing-m-and-m++-programs">Testing M and M++ programs</a></li><li><a href="#compiling-m-and-m++-programs">Compiling M and M++ programs</a></li><li><a href="#utils">Utils</a></li></ul></nav></header><h2 id="m-frontend"><a href="#m-frontend" class="anchor"></a>M Frontend</h2><p>First, the source code is parsed according to the Menhir grammar specified in <a href="Mlang/Mparser/index.html"><code>Mlang.Mparser</code></a>. The grammar is not exactly LR(1) so we rely on <a href="Mlang/Parse_utils/index.html"><code>Mlang.Parse_utils</code></a> to backtrack, especially on symbol parsing. The target intermediate representation is <a href="Mlang/Mast/index.html"><code>Mlang.Mast</code></a>, which is very close to the concrete syntax and can be printed using <a href="Mlang/Format_mast/index.html"><code>Mlang.Format_mast</code></a>.</p><ul class="modules"><li><a href="Mlang/Mast/index.html"><code>Mlang.Mast</code></a></li><li><a href="Mlang/Format_mast/index.html"><code>Mlang.Format_mast</code></a></li><li><a href="Mlang/Mparser/index.html"><code>Mlang.Mparser</code></a></li><li><a href="Mlang/Parse_utils/index.html"><code>Mlang.Parse_utils</code></a></li></ul><h2 id="m-intermediate-representation"><a href="#m-intermediate-representation" class="anchor"></a>M Intermediate representation</h2><p>The M language has a lot of weird syntactic sugars and constructs linked to its usage inside multiple DGFiP applications. <a href="Mlang/Mast_to_mir/index.html"><code>Mlang.Mast_to_mir</code></a> extracts from the AST the computational core corresponding to a DGFiP application into the M Variable Graph (<a href="Mlang/Mir/index.html"><code>Mlang.Mir</code></a>), which consists basically of a flat map of all the definitions of the variables used in the application. The type system of M is very primitive, and basically all programs typecheck ; however <a href="Mlang/Mir_typechecker/index.html"><code>Mlang.Mir_typechecker</code></a> provides a top-down typechecking algorithm to split simple variables from tables.</p><p>At this point, the <a href="Mlang/Mir_dependency_graph/index.html"><code>Mlang.Mir_dependency_graph</code></a> modules interprets the MIR as a first-class graph and computes various reachability and cycle analysis in order to determine the computational flow inside the program. This dependency order is encapsulated with the program in <a href="Mlang/Mir_interface/index.html"><code>Mlang.Mir_interface</code></a>. Some typechecking and macro expansion is performed by <a href="Mlang/Mir_typechecker/index.html"><code>Mlang.Mir_typechecker</code></a>.</p><ul class="modules"><li><a href="Mlang/Mir/index.html"><code>Mlang.Mir</code></a></li><li><a href="Mlang/Mast_to_mir/index.html"><code>Mlang.Mast_to_mir</code></a></li><li><a href="Mlang/Format_mir/index.html"><code>Mlang.Format_mir</code></a></li><li><a href="Mlang/Mir_typechecker/index.html"><code>Mlang.Mir_typechecker</code></a></li><li><a href="Mlang/Mir_interface/index.html"><code>Mlang.Mir_interface</code></a></li><li><a href="Mlang/Mir_dependency_graph/index.html"><code>Mlang.Mir_dependency_graph</code></a></li></ul><h2 id="m++-frontend"><a href="#m++-frontend" class="anchor"></a>M++ Frontend</h2><p>The M code can be called several times through a sort of driver that saves some variables between calls. This driver is encoded in the M++ domain-specific language that Mlang handles together with the M. M++ is parsed with <a href="Mlang/Mpp_parser/index.html"><code>Mlang.Mpp_parser</code></a></p><ul class="modules"><li><a href="Mlang/Mpp_parser/index.html"><code>Mlang.Mpp_parser</code></a></li><li><a href="Mlang/Mpp_ast/index.html"><code>Mlang.Mpp_ast</code></a></li></ul><h2 id="m++-intermediate-representation"><a href="#m++-intermediate-representation" class="anchor"></a>M++ Intermediate representation</h2><p>From the M++ AST, <a href="Mlang/Mpp_frontend/index.html"><code>Mlang.Mpp_frontend</code></a> translates to <a href="Mlang/Mpp_ir/index.html"><code>Mlang.Mpp_ir</code></a> by eliminating some syntactic sugars.</p><ul class="modules"><li><a href="Mlang/Mpp_frontend/index.html"><code>Mlang.Mpp_frontend</code></a></li><li><a href="Mlang/Mpp_ir/index.html"><code>Mlang.Mpp_ir</code></a></li><li><a href="Mlang/Mpp_format/index.html"><code>Mlang.Mpp_format</code></a></li></ul><h2 id="m/m++-common-backend-intermediate-representation"><a href="#m/m++-common-backend-intermediate-representation" class="anchor"></a>M/M++ Common backend intermediate representation</h2><p>The module <a href="Mlang/Mpp_ir_to_bir/index.html"><code>Mlang.Mpp_ir_to_bir</code></a> performs the inlining of all the M calls in the M++ programs and yields a single program in a new common intermediate representation, <a href="Mlang/Bir/index.html"><code>Mlang.Bir</code></a>. Inputs and outputs for this representation can be specified using <a href="Mlang/Bir_interface/index.html"><code>Mlang.Bir_interface</code></a>.</p><p>The BIR representation is equipped with a fully fledged interpreter, <a href="Mlang/Bir_interpreter/index.html"><code>Mlang.Bir_interpreter</code></a>. The interpreter is instrumented for code coverage via <a href="Mlang/Bir_instrumentation/index.html"><code>Mlang.Bir_instrumentation</code></a>, and can be parametrized via multiple sorts of custom floating point values for precision testing (<a href="Mlang/Bir_number/index.html"><code>Mlang.Bir_number</code></a>).</p><ul class="modules"><li><a href="Mlang/Bir_instrumentation/index.html"><code>Mlang.Bir_instrumentation</code></a></li><li><a href="Mlang/Bir_interface/index.html"><code>Mlang.Bir_interface</code></a></li><li><a href="Mlang/Bir_interpreter/index.html"><code>Mlang.Bir_interpreter</code></a></li><li><a href="Mlang/Bir_number/index.html"><code>Mlang.Bir_number</code></a></li><li><a href="Mlang/Bir/index.html"><code>Mlang.Bir</code></a></li><li><a href="Mlang/Format_bir/index.html"><code>Mlang.Format_bir</code></a></li></ul><h2 id="optimizations"><a href="#optimizations" class="anchor"></a>Optimizations</h2><p>While BIR is an AST-based representation, <a href="Mlang/Oir/index.html"><code>Mlang.Oir</code></a> defines a dual of BIR in a control-flow-graph (CFG) for. You can go back and forth between those two implementations using <span class="xref-unresolved" title="unresolved reference to &quot;Mpp.Bir_to_oir&quot;"><code>Mpp</code>.Bir_to_oir</span>.</p><p>OIR is the right place to perform some basic program optimizations. <a href="Mlang/Inlining/index.html"><code>Mlang.Inlining</code></a> expands some of the small rules into their full expressions, while <a href="Mlang/Partial_evaluation/index.html"><code>Mlang.Partial_evaluation</code></a> and <a href="Mlang/Dead_code_removal/index.html"><code>Mlang.Dead_code_removal</code></a> simplify the program depending on the inputs and outputs. The main optimizing loop is implemented in <a href="Mlang/Oir_optimizations/index.html"><code>Mlang.Oir_optimizations</code></a>.</p><ul class="modules"><li><a href="Mlang/Oir_optimizations/index.html"><code>Mlang.Oir_optimizations</code></a></li><li><a href="Mlang/Inlining/index.html"><code>Mlang.Inlining</code></a></li><li><a href="Mlang/Partial_evaluation/index.html"><code>Mlang.Partial_evaluation</code></a></li><li><a href="Mlang/Dead_code_removal/index.html"><code>Mlang.Dead_code_removal</code></a></li></ul><h2 id="testing-m-and-m++-programs"><a href="#testing-m-and-m++-programs" class="anchor"></a>Testing M and M++ programs</h2><p>Mlang comes with a testing framework for M and M++ programs that is based on the test format used by the DGFiP. The test files are parsed with <a href="Mlang/Test_parser/index.html"><code>Mlang.Test_parser</code></a> into <a href="Mlang/Test_ast/index.html"><code>Mlang.Test_ast</code></a>. Then, single or batch testing can be performed using <a href="Mlang/Test_interpreter/index.html"><code>Mlang.Test_interpreter</code></a>.</p><ul class="modules"><li><a href="Mlang/Test_ast/index.html"><code>Mlang.Test_ast</code></a></li><li><a href="Mlang/Test_interpreter/index.html"><code>Mlang.Test_interpreter</code></a></li><li><a href="Mlang/Test_parser/index.html"><code>Mlang.Test_parser</code></a></li></ul><h2 id="compiling-m-and-m++-programs"><a href="#compiling-m-and-m++-programs" class="anchor"></a>Compiling M and M++ programs</h2><p>M/M++ programs can be compiled to other programming languages using several backends that take BIR and produce source code files in their respective languages.</p><ul class="modules"><li><span class="xref-unresolved" title="unresolved reference to &quot;Mlang.Bir_to_python&quot;"><a href="Mlang/index.html"><code>Mlang</code></a>.Bir_to_python</span></li><li><span class="xref-unresolved" title="unresolved reference to &quot;Mlang.Bir_to_c&quot;"><a href="Mlang/index.html"><code>Mlang</code></a>.Bir_to_c</span></li><li><a href="Mlang/Bir_to_dgfip_c/index.html"><code>Mlang.Bir_to_dgfip_c</code></a></li></ul><h2 id="utils"><a href="#utils" class="anchor"></a>Utils</h2><ul class="modules"><li><a href="Mlang/Cli/index.html"><code>Mlang.Cli</code></a></li><li><a href="Mlang/Errors/index.html"><code>Mlang.Errors</code></a></li><li><a href="Mlang/Pos/index.html"><code>Mlang.Pos</code></a></li></ul></div></body></html>