<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Mlang__Mast_to_mir (mlang.Mlang__Mast_to_mir)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">mlang</a> &#x00BB; Mlang__Mast_to_mir</nav><h1>Module <code>Mlang__Mast_to_mir</code></h1><p><code>Mast</code> to <code>Mir</code> translation of M programs.</p><nav class="toc"><ul><li><a href="#translation-context">Translation context</a><ul><li><a href="#loop-translation-context">Loop translation context</a></li><li><a href="#general-translation-context">General translation context</a></li></ul></li><li><a href="#translation-helpers">Translation helpers</a></li><li><a href="#main-translation-function">Main translation function</a></li></ul></nav></header><section><header><h2 id="translation-context"><a href="#translation-context" class="anchor"></a>Translation context</h2></header><section><header><h3 id="loop-translation-context"><a href="#loop-translation-context" class="anchor"></a>Loop translation context</h3></header><aside><p>The M language has a strange way of doing loops. We translate them by unrolling; but for that we need a context to hold the loop parameters, which consists of a mapping from characters to integers or other characters.</p></aside><dl><dt class="spec type" id="type-loop_param_value"><a href="#type-loop_param_value" class="anchor"></a><code><span class="keyword">type</span> loop_param_value</code><code> = </code><table class="variant"><tr id="type-loop_param_value.VarName" class="anchored"><td class="def constructor"><a href="#type-loop_param_value.VarName" class="anchor"></a><code>| </code><code><span class="constructor">VarName</span> <span class="keyword">of</span> <a href="../Mlang/Mast/index.html#type-variable_name">Mlang.Mast.variable_name</a></code></td></tr><tr id="type-loop_param_value.RangeInt" class="anchored"><td class="def constructor"><a href="#type-loop_param_value.RangeInt" class="anchor"></a><code>| </code><code><span class="constructor">RangeInt</span> <span class="keyword">of</span> int</code></td></tr></table></dt><dd><p>The values of the map can be either strings of integers</p></dd></dl><div class="spec module" id="module-ConstMap"><a href="#module-ConstMap" class="anchor"></a><code><span class="keyword">module</span> ConstMap : Stdlib.Map.S <span class="keyword">with</span> <span class="keyword">type</span> <a href="index.html#module-ConstMap">ConstMap</a>.key = <a href="../Mlang/Mast/index.html#type-variable_name">Mlang.Mast.variable_name</a></code></div><dl><dt class="spec module" id="module-ParamsMap"><a href="#module-ParamsMap" class="anchor"></a><code><span class="keyword">module</span> ParamsMap : Stdlib.Map.S <span class="keyword">with</span> <span class="keyword">type</span> <a href="index.html#module-ParamsMap">ParamsMap</a>.key = Stdlib.Char.t</code></dt><dd><p>Map whose keys are loop parameters</p></dd></dl><dl><dt class="spec type" id="type-loop_context"><a href="#type-loop_context" class="anchor"></a><code><span class="keyword">type</span> loop_context</code><code> = <span><span>(<a href="index.html#type-loop_param_value">loop_param_value</a> * int)</span> <a href="index.html#module-ParamsMap">ParamsMap</a>.t</span></code></dt><dd><p>This is the context when iterating a loop : for each loop parameter, we have access to the current value of this loop parameter in this iteration.</p></dd></dl></section><section><header><h3 id="general-translation-context"><a href="#general-translation-context" class="anchor"></a>General translation context</h3></header><dl><dt class="spec type" id="type-translating_context"><a href="#type-translating_context" class="anchor"></a><code><span class="keyword">type</span> translating_context</code><code> = </code><code>{</code><table class="record"><tr id="type-translating_context.table_definition" class="anchored"><td class="def field"><a href="#type-translating_context.table_definition" class="anchor"></a><code>table_definition : bool;</code></td><td class="doc"><p><code>true</code> if translating an expression susceptible to contain a generic table index</p></td></tr><tr id="type-translating_context.idmap" class="anchored"><td class="def field"><a href="#type-translating_context.idmap" class="anchor"></a><code>idmap : <a href="../Mlang/Mir/index.html#type-idmap">Mlang.Mir.idmap</a>;</code></td><td class="doc"><p>Current string-to-<span class="xref-unresolved" title="unresolved reference to &quot;Mir.Variable.t&quot;"><span class="xref-unresolved" title="unresolved reference to &quot;Mir.Variable&quot;"><code>Mir</code>.Variable</span>.t</span> mapping</p></td></tr><tr id="type-translating_context.lc" class="anchored"><td class="def field"><a href="#type-translating_context.lc" class="anchor"></a><code>lc : <span><a href="index.html#type-loop_context">loop_context</a> option</span>;</code></td><td class="doc"><p>Current loop translation context</p></td></tr><tr id="type-translating_context.const_map" class="anchored"><td class="def field"><a href="#type-translating_context.const_map" class="anchor"></a><code>const_map : <span><span>float <a href="../Mlang/Pos/index.html#type-marked">Mlang.Pos.marked</a></span> <a href="index.html#module-ConstMap">ConstMap</a>.t</span>;</code></td><td class="doc"><p>Mapping from constant variables to their value</p></td></tr><tr id="type-translating_context.exec_number" class="anchored"><td class="def field"><a href="#type-translating_context.exec_number" class="anchor"></a><code>exec_number : <a href="../Mlang/Mir/index.html#type-execution_number">Mlang.Mir.execution_number</a>;</code></td><td class="doc"><p>Number of the rule of verification condition being translated</p></td></tr></table><code>}</code></dt></dl></section></section><section><header><h2 id="translation-helpers"><a href="#translation-helpers" class="anchor"></a>Translation helpers</h2></header><dl><dt class="spec value" id="val-get_var_from_name"><a href="#val-get_var_from_name" class="anchor"></a><code><span class="keyword">val</span> get_var_from_name : <a href="../Mlang/Mir/index.html#type-idmap">Mlang.Mir.idmap</a> <span>&#45;&gt;</span> <span>string <a href="../Mlang/Pos/index.html#type-marked">Mlang.Pos.marked</a></span> <span>&#45;&gt;</span> <a href="../Mlang/Mir/index.html#type-execution_number">Mlang.Mir.execution_number</a> <span>&#45;&gt;</span> bool <span>&#45;&gt;</span> <a href="../Mlang/Mir/Variable/index.html#type-t">Mlang.Mir.Variable.t</a></code></dt><dd><p>Queries a <code>type: Mir.variable.t</code> from an <code>type:idmap</code> mapping, the name of a variable and the rule number from which the variable is requested. Returns the variable with the same name and highest rule number that is below the current rule number from where this variable is requested</p></dd></dl><dl><dt class="spec value" id="val-list_max_execution_number"><a href="#val-list_max_execution_number" class="anchor"></a><code><span class="keyword">val</span> list_max_execution_number : <span><a href="../Mlang/Mir/Variable/index.html#type-t">Mlang.Mir.Variable.t</a> list</span> <span>&#45;&gt;</span> <a href="../Mlang/Mir/Variable/index.html#type-t">Mlang.Mir.Variable.t</a></code></dt><dd><p>Helper to compute the max SSA candidate in a list</p></dd></dl><dl><dt class="spec value" id="val-translate_expression"><a href="#val-translate_expression" class="anchor"></a><code><span class="keyword">val</span> translate_expression : <a href="index.html#type-translating_context">translating_context</a> <span>&#45;&gt;</span> <span><a href="../Mlang/Mast/index.html#type-expression">Mlang.Mast.expression</a> <a href="../Mlang/Pos/index.html#type-marked">Mlang.Pos.marked</a></span> <span>&#45;&gt;</span> <span><a href="../Mlang/Mir/index.html#type-expression">Mlang.Mir.expression</a> <a href="../Mlang/Pos/index.html#type-marked">Mlang.Pos.marked</a></span></code></dt><dd><p>Main translation function for expressions</p></dd></dl><dl><dt class="spec value" id="val-dummy_exec_number"><a href="#val-dummy_exec_number" class="anchor"></a><code><span class="keyword">val</span> dummy_exec_number : <a href="../Mlang/Pos/index.html#type-t">Mlang.Pos.t</a> <span>&#45;&gt;</span> <a href="../Mlang/Mir/index.html#type-execution_number">Mlang.Mir.execution_number</a></code></dt><dd><p>Dummy execution number used for variable declarations</p></dd></dl><dl><dt class="spec value" id="val-get_conds"><a href="#val-get_conds" class="anchor"></a><code><span class="keyword">val</span> get_conds : <span><a href="../Mlang/Mir/Error/index.html#type-t">Mlang.Mir.Error.t</a> list</span> <span>&#45;&gt;</span> <span><span>float <a href="../Mlang/Pos/index.html#type-marked">Mlang.Pos.marked</a></span> <a href="index.html#module-ConstMap">ConstMap</a>.t</span> <span>&#45;&gt;</span> <a href="../Mlang/Mir/index.html#type-idmap">Mlang.Mir.idmap</a> <span>&#45;&gt;</span> <a href="../Mlang/Mast/index.html#type-program">Mlang.Mast.program</a> <span>&#45;&gt;</span> <span><a href="../Mlang/Mir/index.html#type-condition_data">Mlang.Mir.condition_data</a> <a href="../Mlang__Mir/index.html#module-VariableMap">Mlang.Mir.VariableMap</a>.t</span></code></dt><dd><p>Returns a map whose keys are dummy variables and whose values are the verification conditions.</p></dd></dl></section><section><header><h2 id="main-translation-function"><a href="#main-translation-function" class="anchor"></a>Main translation function</h2></header><dl><dt class="spec value" id="val-translate"><a href="#val-translate" class="anchor"></a><code><span class="keyword">val</span> translate : <a href="../Mlang/Mast/index.html#type-program">Mlang.Mast.program</a> <span>&#45;&gt;</span> <a href="../Mlang/Mir/index.html#type-program">Mlang.Mir.program</a></code></dt><dd><p>Main translation function from the M AST to the M Variable Graph. This function performs 6 linear passes on the input code:</p><ul><li><code>get_constants</code> gets the value of all constant variables, the values of which are needed to compute certain loop bounds;</li><li><code>get_variables_decl</code> retrieves the declarations of all other variables and errors;</li><li><code>get_var_redefinitions</code> incorporates into <code>idmap</code> all definitions inside rules along with their execution number;</li><li><code>get_var_data</code> is the workhorse pass that translates all the expressions corresponding to the definitions;</li><li><code>add_dummy_definition_for_variable_declaration</code> adds <code>Undefined</code> definitions placeholder for all variables declarations;</li><li><code>get_errors_conds</code> parses the verification conditions definitions.</li></ul></dd></dl></section></div></body></html>