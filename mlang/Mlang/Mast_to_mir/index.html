<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Mast_to_mir (mlang.Mlang.Mast_to_mir)</title><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">mlang</a> &#x00BB; <a href="../index.html">Mlang</a> &#x00BB; Mast_to_mir</nav><header class="odoc-preamble"><h1>Module <code><span>Mlang.Mast_to_mir</span></code></h1><p><a href="../Mast/index.html"><code>Mast</code></a> to <a href="../Mir/index.html"><code>Mir</code></a> translation of M programs.</p></header><nav class="odoc-toc"><ul><li><a href="#translation-context">Translation context</a><ul><li><a href="#loop-translation-context">Loop translation context</a></li><li><a href="#general-translation-context">General translation context</a></li></ul></li><li><a href="#translation-helpers">Translation helpers</a></li><li><a href="#main-translation-function">Main translation function</a></li></ul></nav><div class="odoc-content"><h2 id="translation-context"><a href="#translation-context" class="anchor"></a>Translation context</h2><h3 id="loop-translation-context"><a href="#loop-translation-context" class="anchor"></a>Loop translation context</h3><p>The M language has a strange way of doing loops. We translate them by unrolling; but for that we need a context to hold the loop parameters, which consists of a mapping from characters to integers or other characters.</p><div class="odoc-spec"><div class="spec type" id="type-loop_param_value" class="anchored"><a href="#type-loop_param_value" class="anchor"></a><code><span><span class="keyword">type</span> loop_param_value</span><span> = </span></code><table><tr id="type-loop_param_value.VarName" class="anchored"><td class="def variant constructor"><a href="#type-loop_param_value.VarName" class="anchor"></a><code><span>| </span><span><span class="constructor">VarName</span> <span class="keyword">of</span> <a href="../Mast/index.html#type-variable_name">Mast.variable_name</a></span></code></td></tr><tr id="type-loop_param_value.RangeInt" class="anchored"><td class="def variant constructor"><a href="#type-loop_param_value.RangeInt" class="anchor"></a><code><span>| </span><span><span class="constructor">RangeInt</span> <span class="keyword">of</span> int</span></code></td></tr></table></div><div class="spec-doc"><p>The values of the map can be either strings of integers</p></div></div><div class="odoc-spec"><div class="spec module" id="module-ConstMap" class="anchored"><a href="#module-ConstMap" class="anchor"></a><code><span><span class="keyword">module</span> <a href="ConstMap/index.html">ConstMap</a></span><span> : <a href="../StrMap/module-type-T/index.html">StrMap.T</a></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-ParamsMap" class="anchored"><a href="#module-ParamsMap" class="anchor"></a><code><span><span class="keyword">module</span> <a href="ParamsMap/index.html">ParamsMap</a></span><span> : <a href="../CharMap/module-type-T/index.html">CharMap.T</a></span></code></div><div class="spec-doc"><p>Map whose keys are loop parameters</p></div></div><div class="odoc-spec"><div class="spec type" id="type-loop_context" class="anchored"><a href="#type-loop_context" class="anchor"></a><code><span><span class="keyword">type</span> loop_context</span><span> = <span><span>(<a href="#type-loop_param_value">loop_param_value</a> * int)</span> <a href="ParamsMap/index.html#type-t">ParamsMap.t</a></span></span></code></div><div class="spec-doc"><p>This is the context when iterating a loop : for each loop parameter, we have access to the current value of this loop parameter in this iteration.</p></div></div><h3 id="general-translation-context"><a href="#general-translation-context" class="anchor"></a>General translation context</h3><div class="odoc-spec"><div class="spec type" id="type-translating_context" class="anchored"><a href="#type-translating_context" class="anchor"></a><code><span><span class="keyword">type</span> translating_context</span><span> = </span><span>{</span></code><table><tr id="type-translating_context.table_definition" class="anchored"><td class="def record field"><a href="#type-translating_context.table_definition" class="anchor"></a><code><span>table_definition : bool;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p><code>true</code> if translating an expression susceptible to contain a generic table index</p><span class="comment-delim">*)</span></td></tr><tr id="type-translating_context.idmap" class="anchored"><td class="def record field"><a href="#type-translating_context.idmap" class="anchor"></a><code><span>idmap : <a href="../Mir/index.html#type-idmap">Mir.idmap</a>;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Current string-to-<a href="../Mir/Variable/index.html#type-t"><code>Mir.Variable.t</code></a> mapping</p><span class="comment-delim">*)</span></td></tr><tr id="type-translating_context.lc" class="anchored"><td class="def record field"><a href="#type-translating_context.lc" class="anchor"></a><code><span>lc : <span><a href="#type-loop_context">loop_context</a> option</span>;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Current loop translation context</p><span class="comment-delim">*)</span></td></tr><tr id="type-translating_context.const_map" class="anchored"><td class="def record field"><a href="#type-translating_context.const_map" class="anchor"></a><code><span>const_map : <span><span>float <a href="../Pos/index.html#type-marked">Pos.marked</a></span> <a href="ConstMap/index.html#type-t">ConstMap.t</a></span>;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Mapping from constant variables to their value</p><span class="comment-delim">*)</span></td></tr><tr id="type-translating_context.exec_number" class="anchored"><td class="def record field"><a href="#type-translating_context.exec_number" class="anchor"></a><code><span>exec_number : <a href="../Mir/index.html#type-execution_number">Mir.execution_number</a>;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Number of the rule of verification condition being translated</p><span class="comment-delim">*)</span></td></tr></table><code><span>}</span></code></div></div><h2 id="translation-helpers"><a href="#translation-helpers" class="anchor"></a>Translation helpers</h2><div class="odoc-spec"><div class="spec value" id="val-get_var_from_name" class="anchored"><a href="#val-get_var_from_name" class="anchor"></a><code><span><span class="keyword">val</span> get_var_from_name : 
  <span><a href="../Mir/index.html#type-idmap">Mir.idmap</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>string <a href="../Pos/index.html#type-marked">Pos.marked</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Mir/index.html#type-execution_number">Mir.execution_number</a> <span class="arrow">&#45;&gt;</span></span>
  <span>bool <span class="arrow">&#45;&gt;</span></span>
  <a href="../Mir/Variable/index.html#type-t">Mir.Variable.t</a></span></code></div><div class="spec-doc"><p>Queries a <code>type: Mir.variable.t</code> from an <code>type:idmap</code> mapping, the name of a variable and the rule number from which the variable is requested. Returns the variable with the same name and highest rule number that is below the current rule number from where this variable is requested</p></div></div><div class="odoc-spec"><div class="spec value" id="val-list_max_execution_number" class="anchored"><a href="#val-list_max_execution_number" class="anchor"></a><code><span><span class="keyword">val</span> list_max_execution_number : <span><span><a href="../Mir/Variable/index.html#type-t">Mir.Variable.t</a> list</span> <span class="arrow">&#45;&gt;</span></span> <a href="../Mir/Variable/index.html#type-t">Mir.Variable.t</a></span></code></div><div class="spec-doc"><p>Helper to compute the max SSA candidate in a list</p></div></div><div class="odoc-spec"><div class="spec value" id="val-translate_expression" class="anchored"><a href="#val-translate_expression" class="anchor"></a><code><span><span class="keyword">val</span> translate_expression : 
  <span><a href="#type-translating_context">translating_context</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Mast/index.html#type-expression">Mast.expression</a> <a href="../Pos/index.html#type-marked">Pos.marked</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Mir/index.html#type-expression">Mir.expression</a> <a href="../Pos/index.html#type-marked">Pos.marked</a></span></span></code></div><div class="spec-doc"><p>Main translation function for expressions</p></div></div><div class="odoc-spec"><div class="spec value" id="val-dummy_exec_number" class="anchored"><a href="#val-dummy_exec_number" class="anchor"></a><code><span><span class="keyword">val</span> dummy_exec_number : <span><a href="../Pos/index.html#type-t">Pos.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Mir/index.html#type-execution_number">Mir.execution_number</a></span></code></div><div class="spec-doc"><p>Dummy execution number used for variable declarations</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get_conds" class="anchored"><a href="#val-get_conds" class="anchor"></a><code><span><span class="keyword">val</span> get_conds : 
  <span><span><span class="type-var">'a</span> <a href="../Mir/CatVarMap/index.html#type-t">Mir.CatVarMap.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Mir/Error/index.html#type-t">Mir.Error.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>float <a href="../Pos/index.html#type-marked">Pos.marked</a></span> <a href="ConstMap/index.html#type-t">ConstMap.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Mir/index.html#type-idmap">Mir.idmap</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Mast/index.html#type-program">Mast.program</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Mir/index.html#type-verif_domain">Mir.verif_domain</a> <a href="../StrSetMap/index.html#type-t">Mast.DomainIdMap.t</a></span> * <span><a href="../Mir/index.html#type-condition_data">Mir.condition_data</a> <a href="../Mir/RuleMap/index.html#type-t">Mir.RuleMap.t</a></span></span></code></div><div class="spec-doc"><p>Returns a map whose keys are dummy variables and whose values are the verification conditions.</p></div></div><h2 id="main-translation-function"><a href="#main-translation-function" class="anchor"></a>Main translation function</h2><div class="odoc-spec"><div class="spec value" id="val-translate" class="anchored"><a href="#val-translate" class="anchor"></a><code><span><span class="keyword">val</span> translate : <span><a href="../Mast/index.html#type-program">Mast.program</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Mir/index.html#type-program">Mir.program</a></span></code></div><div class="spec-doc"><p>Main translation function from the M AST to the M Variable Graph. This function performs 6 linear passes on the input code:</p><ul><li><code>get_constants</code> gets the value of all constant variables, the values of which are needed to compute certain loop bounds;</li><li><code>get_variables_decl</code> retrieves the declarations of all other variables and errors;</li><li><code>get_var_redefinitions</code> incorporates into <code>idmap</code> all definitions inside rules along with their execution number;</li><li><code>get_var_data</code> is the workhorse pass that translates all the expressions corresponding to the definitions;</li><li><code>add_dummy_definition_for_variable_declaration</code> adds <code>Undefined</code> definitions placeholder for all variables declarations;</li><li><code>get_errors_conds</code> parses the verification conditions definitions.</li></ul></div></div></div></body></html>